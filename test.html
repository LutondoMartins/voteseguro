<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatvia - Modern Chat Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'bounce-subtle': 'bounceSubtle 0.6s ease-out',
                        'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                    },
                    backdropBlur: {
                        'xs': '2px',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes bounceSubtle {
            0%, 20%, 53%, 80%, 100% { animation-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000); transform: translate3d(0,0,0); }
            40%, 43% { animation-timing-function: cubic-bezier(0.755, 0.050, 0.855, 0.060); transform: translate3d(0, -8px, 0); }
            70% { animation-timing-function: cubic-bezier(0.755, 0.050, 0.855, 0.060); transform: translate3d(0, -4px, 0); }
            90% { transform: translate3d(0,-1px,0); }
        }
        @keyframes glow {
            from { box-shadow: 0 0 20px -10px #3b82f6; }
            to { box-shadow: 0 0 20px -5px #3b82f6; }
        }
        
        .chat-scroll::-webkit-scrollbar { width: 4px; }
        .chat-scroll::-webkit-scrollbar-track { background: transparent; }
        .chat-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 2px; }
        .chat-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .message-bubble {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .message-bubble:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .typing-dot {
            animation: typingDot 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typingDot {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .chat-item {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .chat-item:hover {
            transform: translateX(4px);
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.05) 0%, rgba(59, 130, 246, 0.1) 100%);
        }
        
        .chat-item.active {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
            border-left: 3px solid #3b82f6;
        }
        
        .floating-action {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .floating-action:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        
        .mobile-menu {
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .mobile-menu.open {
            transform: translateX(0);
        }
        
        .status-indicator {
            animation: pulse-slow 2s infinite;
        }
        
        /* Dark mode styles */
        .dark .glass-morphism {
            background: rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Message reactions */
        .message-reactions {
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .message-bubble:hover .message-reactions {
            opacity: 1;
            transform: scale(1);
        }
        
        /* Voice message waveform */
        .waveform {
            display: flex;
            align-items: center;
            gap: 2px;
        }
        
        .wave-bar {
            width: 3px;
            background: currentColor;
            border-radius: 2px;
            animation: waveAnimation 1s ease-in-out infinite;
        }
        
        .wave-bar:nth-child(1) { height: 8px; animation-delay: 0s; }
        .wave-bar:nth-child(2) { height: 16px; animation-delay: 0.1s; }
        .wave-bar:nth-child(3) { height: 12px; animation-delay: 0.2s; }
        .wave-bar:nth-child(4) { height: 20px; animation-delay: 0.3s; }
        .wave-bar:nth-child(5) { height: 10px; animation-delay: 0.4s; }
        
        @keyframes waveAnimation {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(0.3); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen overflow-hidden">
    <!-- Mobile overlay -->
    <div id="mobileOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden" onclick="toggleMobileMenu()"></div>
    
    <div class="flex h-screen relative">
        <!-- Mobile Menu Button -->
        <button id="mobileMenuBtn" 
                class="fixed top-4 left-4 z-50 lg:hidden bg-white shadow-lg rounded-full p-3 floating-action"
                onclick="toggleMobileMenu()">
            <i class="fas fa-bars text-gray-700"></i>
        </button>

        <!-- Sidebar -->
        <div id="sidebar" class="w-80 bg-white/80 backdrop-blur-xl border-r border-white/20 flex flex-col shadow-2xl mobile-menu lg:relative lg:translate-x-0 absolute inset-y-0 left-0 z-50">
            <!-- Header -->
            <div class="p-6 border-b border-gray-100/50">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-comments text-white text-sm"></i>
                        </div>
                        <h1 class="text-xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent">Chatvia</h1>
                    </div>
                    <div class="flex space-x-1">
                        <button class="p-2 hover:bg-gray-100/50 rounded-xl transition-all duration-200 group">
                            <i class="fas fa-search text-gray-500 group-hover:text-blue-500 transition-colors"></i>
                        </button>
                        <button class="p-2 hover:bg-gray-100/50 rounded-xl transition-all duration-200 group">
                            <i class="fas fa-plus text-gray-500 group-hover:text-blue-500 transition-colors"></i>
                        </button>
                        <button onclick="toggleTheme()" class="p-2 hover:bg-gray-100/50 rounded-xl transition-all duration-200 group">
                            <i id="themeIcon" class="fas fa-moon text-gray-500 group-hover:text-blue-500 transition-colors"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Search -->
                <div class="relative group">
                    <input type="text" id="searchInput" placeholder="Pesquisar conversas..." 
                           class="w-full pl-12 pr-4 py-3 bg-gray-50/50 border-0 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:bg-white transition-all duration-300 placeholder-gray-400">
                    <i class="fas fa-search absolute left-4 top-4 text-gray-400 group-focus-within:text-blue-500 transition-colors"></i>
                    <div class="absolute right-3 top-3">
                        <kbd class="px-2 py-1 text-xs bg-gray-200 rounded opacity-50">‚åòK</kbd>
                    </div>
                </div>
            </div>

            <!-- Chat List -->
            <div class="flex-1 overflow-y-auto chat-scroll">
                <div class="p-3">
                    <!-- Status tabs -->
                    <div class="flex space-x-1 mb-4 bg-gray-100/50 rounded-xl p-1">
                        <button class="flex-1 py-2 px-3 text-sm font-medium rounded-lg bg-white text-blue-600 shadow-sm transition-all">
                            Todas
                        </button>
                        <button class="flex-1 py-2 px-3 text-sm font-medium rounded-lg text-gray-500 hover:text-gray-700 transition-all">
                            N√£o lidas
                        </button>
                        <button class="flex-1 py-2 px-3 text-sm font-medium rounded-lg text-gray-500 hover:text-gray-700 transition-all relative">
                            Grupos
                            <span class="absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                        </button>
                    </div>
                    
                    <div id="chatList" class="space-y-1">
                        <!-- Chat items will be populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Profile -->
            <div class="p-4 border-t border-gray-100/50 bg-gradient-to-r from-blue-50/50 to-purple-50/50">
                <div class="flex items-center space-x-3">
                    <div class="relative">
                        <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=48&h=48&fit=crop&crop=face" 
                             alt="Perfil" class="w-12 h-12 rounded-full ring-2 ring-blue-500/20">
                        <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full status-indicator"></div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-semibold text-gray-900 truncate">Jo√£o Silva</p>
                        <p class="text-xs text-gray-500 flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-1"></span>
                            Online agora
                        </p>
                    </div>
                    <div class="flex space-x-1">
                        <button class="p-2 hover:bg-white/50 rounded-xl transition-all duration-200">
                            <i class="fas fa-cog text-gray-500 hover:text-blue-500 transition-colors"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="flex-1 flex flex-col bg-white/30 backdrop-blur-sm">
            <!-- Chat Header -->
            <div id="chatHeader" class="bg-white/80 backdrop-blur-xl border-b border-white/20 p-4 shadow-sm">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <img id="chatAvatar" src="https://images.unsplash.com/photo-1494790108755-2616b612b786?w=48&h=48&fit=crop&crop=face" 
                                 alt="Avatar" class="w-12 h-12 rounded-full ring-2 ring-blue-500/20">
                            <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full"></div>
                        </div>
                        <div>
                            <h2 id="chatName" class="font-semibold text-gray-900 text-lg">Maria Santos</h2>
                            <p id="chatStatus" class="text-sm text-gray-500 flex items-center">
                                <span class="w-2 h-2 bg-green-500 rounded-full mr-1 animate-pulse"></span>
                                Digitando...
                            </p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button class="p-3 hover:bg-blue-50 rounded-xl transition-all duration-200 group floating-action" onclick="startCall('audio')">
                            <i class="fas fa-phone text-gray-600 group-hover:text-blue-600 transition-colors"></i>
                        </button>
                        <button class="p-3 hover:bg-blue-50 rounded-xl transition-all duration-200 group floating-action" onclick="startCall('video')">
                            <i class="fas fa-video text-gray-600 group-hover:text-blue-600 transition-colors"></i>
                        </button>
                        <button class="p-3 hover:bg-blue-50 rounded-xl transition-all duration-200 group">
                            <i class="fas fa-ellipsis-v text-gray-600 group-hover:text-blue-600 transition-colors"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Messages Area -->
            <div id="messagesContainer" class="flex-1 overflow-y-auto chat-scroll p-6 bg-gradient-to-b from-blue-50/20 to-purple-50/20">
                <div id="messages" class="space-y-6 max-w-4xl mx-auto">
                    <!-- Messages will be populated by JS -->
                </div>
                
                <!-- Typing Indicator -->
                <div id="typingIndicator" class="hidden flex items-start space-x-3 mt-6 animate-fade-in max-w-4xl mx-auto">
                    <img src="https://images.unsplash.com/photo-1494790108755-2616b612b786?w=32&h=32&fit=crop&crop=face" 
                         alt="Avatar" class="w-8 h-8 rounded-full">
                    <div class="bg-white/80 backdrop-blur-sm rounded-2xl px-4 py-3 shadow-lg border border-white/20 max-w-xs">
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Message Input -->
            <div class="bg-white/80 backdrop-blur-xl border-t border-white/20 p-4 shadow-lg">
                <div class="max-w-4xl mx-auto">
                    <!-- Quick actions -->
                    <div class="flex space-x-2 mb-3 overflow-x-auto pb-2">
                        <button class="flex items-center space-x-2 bg-blue-50 hover:bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm transition-all whitespace-nowrap">
                            <i class="fas fa-bolt text-xs"></i>
                            <span>Resposta r√°pida</span>
                        </button>
                        <button class="flex items-center space-x-2 bg-green-50 hover:bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm transition-all whitespace-nowrap">
                            <i class="fas fa-calendar text-xs"></i>
                            <span>Agendar</span>
                        </button>
                        <button class="flex items-center space-x-2 bg-purple-50 hover:bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm transition-all whitespace-nowrap">
                            <i class="fas fa-magic text-xs"></i>
                            <span>IA Assistant</span>
                        </button>
                    </div>
                    
                    <div class="flex items-end space-x-3">
                        <div class="flex space-x-2">
                            <button class="p-3 hover:bg-gray-100 rounded-xl transition-all duration-200 group" onclick="toggleAttachMenu()">
                                <i class="fas fa-paperclip text-gray-500 group-hover:text-blue-500 transition-colors"></i>
                            </button>
                            <button class="p-3 hover:bg-gray-100 rounded-xl transition-all duration-200 group" onclick="startVoiceRecord()">
                                <i class="fas fa-microphone text-gray-500 group-hover:text-red-500 transition-colors"></i>
                            </button>
                        </div>
                        
                        <div class="flex-1 relative">
                            <textarea id="messageInput" placeholder="Digite sua mensagem... (Shift + Enter para nova linha)" 
                                   rows="1"
                                   class="w-full px-4 py-3 pr-20 border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent resize-none transition-all duration-300 bg-white/50 backdrop-blur-sm"
                                   style="max-height: 120px;"></textarea>
                            
                            <!-- Emoji picker button -->
                            <button class="absolute right-12 bottom-3 p-1 hover:bg-gray-100 rounded-full transition-all" onclick="toggleEmojiPicker()">
                                <i class="fas fa-smile text-gray-500 hover:text-yellow-500 transition-colors"></i>
                            </button>
                            
                            <!-- Character counter -->
                            <div class="absolute right-3 bottom-1 text-xs text-gray-400">
                                <span id="charCounter">0</span>/1000
                            </div>
                        </div>
                        
                        <button id="sendButton" onclick="sendMessage()" 
                                class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-3 rounded-xl transition-all duration-300 floating-action disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    
                    <!-- Attachment menu -->
                    <div id="attachMenu" class="hidden absolute bottom-20 left-20 bg-white rounded-2xl shadow-2xl border border-gray-100 p-2 animate-slide-up">
                        <button class="flex items-center space-x-3 w-full p-3 hover:bg-gray-50 rounded-xl transition-all">
                            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-image text-blue-600 text-sm"></i>
                            </div>
                            <span class="text-sm text-gray-700">Foto ou v√≠deo</span>
                        </button>
                        <button class="flex items-center space-x-3 w-full p-3 hover:bg-gray-50 rounded-xl transition-all">
                            <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-file text-green-600 text-sm"></i>
                            </div>
                            <span class="text-sm text-gray-700">Documento</span>
                        </button>
                        <button class="flex items-center space-x-3 w-full p-3 hover:bg-gray-50 rounded-xl transition-all">
                            <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-map-marker-alt text-purple-600 text-sm"></i>
                            </div>
                            <span class="text-sm text-gray-700">Localiza√ß√£o</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Voice recording modal -->
    <div id="voiceModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center">
        <div class="bg-white rounded-3xl p-8 max-w-sm mx-4 text-center shadow-2xl">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-microphone text-red-500 text-2xl animate-pulse"></i>
            </div>
            <h3 class="text-lg font-semibold mb-2">Gravando √°udio...</h3>
            <p class="text-gray-600 mb-4">Toque para parar a grava√ß√£o</p>
            <div class="waveform mb-4 justify-center">
                <div class="wave-bar bg-red-500"></div>
                <div class="wave-bar bg-red-500"></div>
                <div class="wave-bar bg-red-500"></div>
                <div class="wave-bar bg-red-500"></div>
                <div class="wave-bar bg-red-500"></div>
            </div>
            <button onclick="stopVoiceRecord()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-full transition-all">
                Parar grava√ß√£o
            </button>
        </div>
    </div>

    <script>
        // Enhanced sample data with more realistic content
        const chatData = [
            {
                id: 1,
                name: "Maria Santos",
                avatar: "https://images.unsplash.com/photo-1494790108755-2616b612b786?w=48&h=48&fit=crop&crop=face",
                lastMessage: "Adorei a proposta! Quando podemos nos reunir? üöÄ",
                time: "agora",
                unread: 3,
                online: true,
                isTyping: true,
                lastSeen: new Date()
            },
            {
                id: 2,
                name: "Pedro Silva",
                avatar: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=48&h=48&fit=crop&crop=face",
                lastMessage: "O projeto est√° 90% conclu√≠do ‚úÖ",
                time: "5 min",
                unread: 0,
                online: true,
                lastSeen: new Date(Date.now() - 5 * 60000)
            },
            {
                id: 3,
                name: "Ana Costa",
                avatar: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=48&h=48&fit=crop&crop=face",
                lastMessage: "Obrigada pela ajuda com o design! üé®",
                time: "1h",
                unread: 1,
                online: false,
                lastSeen: new Date(Date.now() - 3600000)
            },
            {
                id: 4,
                name: "Carlos Lima",
                avatar: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=48&h=48&fit=crop&crop=face",
                lastMessage: "Reuni√£o reagendada para quinta-feira üìÖ",
                time: "2h",
                unread: 0,
                online: false,
                lastSeen: new Date(Date.now() - 7200000)
            },
            {
                id: 5,
                name: "Team Design",
                avatar: "https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=48&h=48&fit=crop&crop=face",
                lastMessage: "Novos mockups dispon√≠veis no Figma üéØ",
                time: "ontem",
                unread: 5,
                online: true,
                isGroup: true
            }
        ];

        const messageTemplates = [
            {
                id: 1,
                text: "Ol√°! Como posso ajudar voc√™ hoje? üòä",
                time: "10:00",
                sent: false,
                type: "text"
            },
            {
                id: 2,
                text: "Oi! Estou bem, obrigado. Gostaria de discutir o novo projeto que comentamos ontem.",
                time: "10:02",
                sent: true,
                type: "text"
            },
            {
                id: 3,
                text: "Perfeito! Tenho algumas ideias interessantes para compartilhar.",
                time: "10:03",
                sent: false,
                type: "text"
            },
            {
                id: 4,
                text: "https://example.com/project-proposal.pdf",
                time: "10:05",
                sent: true,
                type: "file",
                fileName: "project-proposal.pdf",
                fileSize: "2.3 MB"
            },
            {
                id: 5,
                text: "Excelente proposta! O cronograma est√° muito bem estruturado üëè",
                time: "10:10",
                sent: false,
                type: "text",
                reactions: ["üëç", "‚ù§Ô∏è"]
            }
        ];

        let currentChat = 1;
        let messages = [...messageTemplates];
        let isTyping = false;
        let isDarkMode = false;
        let typingTimer;

        // Initialize app
        function init() {
            renderChatList();
            renderMessages();
            setupEventListeners();
            setupVoiceCommand();
            initializeSearch();
        }

        // Enhanced chat list rendering with better UX
        function renderChatList() {
            const chatList = document.getElementById('chatList');
            chatList.innerHTML = '';

            chatData.forEach((chat, index) => {
                const chatItem = document.createElement('div');
                chatItem.className = `chat-item p-4 cursor-pointer rounded-xl mb-2 ${chat.id === currentChat ? 'active' : ''}`;
                chatItem.onclick = () => selectChat(chat);
                
                // Add stagger animation
                chatItem.style.animationDelay = `${index * 50}ms`;
                chatItem.classList.add('animate-fade-in');

                const unreadBadge = chat.unread > 0 ? 
                    `<div class="ml-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center font-medium animate-bounce-subtle">${chat.unread > 99 ? '99+' : chat.unread}</div>` : '';

                const onlineIndicator = chat.online ? 
                    '<div class="absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 border-2 border-white rounded-full"></div>' : '';

                const typingIndicator = chat.isTyping ? 
                    '<span class="text-blue-500 text-xs flex items-center"><i class="fas fa-circle text-xs mr-1 animate-pulse"></i>digitando...</span>' : 
                    `<span class="text-xs text-gray-500">${chat.time}</span>`;

                const groupIcon = chat.isGroup ? '<i class="fas fa-users text-xs text-gray-400 mr-1"></i>' : '';

                chatItem.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <img src="${chat.avatar}" alt="${chat.name}" class="w-12 h-12 rounded-full object-cover ring-2 ring-transparent hover:ring-blue-200 transition-all">
                            ${onlineIndicator}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-start">
                                <h3 class="text-sm font-semibold text-gray-900 truncate flex items-center">
                                    ${groupIcon}${chat.name}
                                </h3>
                                <div class="flex items-center space-x-2">
                                    ${typingIndicator}
                                    ${unreadBadge}
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 truncate mt-1">${chat.lastMessage}</p>
                        </div>
                    </div>
                `;

                chatList.appendChild(chatItem);
            });
        }

        // Enhanced chat selection with smooth transitions
        function selectChat(chat) {
            if (currentChat === chat.id) return;
            
            currentChat = chat.id;
            
            // Update header with animation
            updateChatHeader(chat);
            
            // Clear typing status
            chat.isTyping = false;
            chat.unread = 0;
            
            // Update chat list
            renderChatList();
            
            // Load messages with stagger animation
            loadChatMessages(chat.id);
            
            // Close mobile menu if open
            if (window.innerWidth < 1024) {
                toggleMobileMenu();
            }
        }

        // Update chat header with smooth transitions
        function updateChatHeader(chat) {
            const header = document.getElementById('chatHeader');
            header.style.opacity = '0.7';
            
            setTimeout(() => {
                document.getElementById('chatName').textContent = chat.name;
                document.getElementById('chatAvatar').src = chat.avatar;
                
                const status = chat.online ? 
                    (chat.isTyping ? 'Digitando...' : 'Online agora') : 
                    `Visto por √∫ltimo ${formatLastSeen(chat.lastSeen)}`;
                    
                document.getElementById('chatStatus').innerHTML = `
                    <span class="w-2 h-2 ${chat.online ? 'bg-green-500 animate-pulse' : 'bg-gray-400'} rounded-full mr-1"></span>
                    ${status}
                `;
                
                header.style.opacity = '1';
            }, 150);
        }

        // Format last seen time
        function formatLastSeen(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'agora mesmo';
            if (minutes < 60) return `${minutes}m`;
            if (hours < 24) return `${hours}h`;
            return `${days}d`;
        }

        // Load messages for specific chat
        function loadChatMessages(chatId) {
            // Simulate loading different message sets for different chats
            const messageSets = {
                1: [...messageTemplates],
                2: [
                    { id: 1, text: "Como est√° o progresso do projeto?", time: "09:00", sent: true, type: "text" },
                    { id: 2, text: "Estamos na reta final! 90% conclu√≠do ‚úÖ", time: "09:05", sent: false, type: "text" },
                    { id: 3, text: "Perfeito! Quando teremos a vers√£o final?", time: "09:06", sent: true, type: "text" }
                ],
                3: [
                    { id: 1, text: "Obrigada pela ajuda com o design! üé®", time: "ontem", sent: false, type: "text" },
                    { id: 2, text: "Foi um prazer ajudar! O resultado ficou incr√≠vel", time: "ontem", sent: true, type: "text" }
                ]
            };
            
            messages = messageSets[chatId] || [...messageTemplates];
            renderMessages();
        }

        // Enhanced message rendering with animations and reactions
        function renderMessages() {
            const messagesContainer = document.getElementById('messages');
            messagesContainer.innerHTML = '';

            messages.forEach((message, index) => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `flex ${message.sent ? 'justify-end' : 'justify-start'} animate-slide-up`;
                messageDiv.style.animationDelay = `${index * 100}ms`;

                const messageContent = createMessageBubble(message);
                
                if (!message.sent) {
                    const currentChatData = chatData.find(c => c.id === currentChat);
                    messageDiv.innerHTML = `
                        <div class="flex items-end space-x-2 max-w-xs lg:max-w-md">
                            <img src="${currentChatData?.avatar}" alt="Avatar" class="w-8 h-8 rounded-full object-cover">
                            ${messageContent}
                        </div>
                    `;
                } else {
                    messageDiv.innerHTML = `<div class="max-w-xs lg:max-w-md">${messageContent}</div>`;
                }

                messagesContainer.appendChild(messageDiv);
            });

            // Smooth scroll to bottom
            setTimeout(() => {
                const container = document.getElementById('messagesContainer');
                container.scrollTo({
                    top: container.scrollHeight,
                    behavior: 'smooth'
                });
            }, 300);
        }

        // Create enhanced message bubble
        function createMessageBubble(message) {
            const bubbleClass = message.sent ? 
                'bg-gradient-to-r from-blue-500 to-blue-600 text-white' : 
                'bg-white/80 backdrop-blur-sm text-gray-800 border border-white/20';
                
            let content = '';
            
            switch(message.type) {
                case 'file':
                    content = `
                        <div class="flex items-center space-x-3 p-1">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-file-pdf text-blue-600"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium">${message.fileName}</p>
                                <p class="text-xs opacity-70">${message.fileSize}</p>
                            </div>
                        </div>
                    `;
                    break;
                default:
                    content = `<p class="text-sm leading-relaxed">${message.text}</p>`;
            }
            
            const reactions = message.reactions ? 
                `<div class="message-reactions flex space-x-1 mt-2">
                    ${message.reactions.map(r => `<span class="text-xs bg-white/20 rounded-full px-2 py-1">${r}</span>`).join('')}
                </div>` : '';
                
            return `
                <div class="message-bubble ${bubbleClass} rounded-2xl px-4 py-3 shadow-lg relative group">
                    ${content}
                    ${reactions}
                    <div class="text-xs opacity-70 mt-2 ${message.sent ? 'text-right' : 'text-left'}">${message.time}</div>
                    
                    <!-- Message actions -->
                    <div class="message-reactions absolute -top-8 right-0 bg-white rounded-full shadow-lg border border-gray-100 flex space-x-1 px-2 py-1">
                        <button onclick="reactToMessage(${message.id}, 'üëç')" class="hover:scale-125 transition-transform">üëç</button>
                        <button onclick="reactToMessage(${message.id}, '‚ù§Ô∏è')" class="hover:scale-125 transition-transform">‚ù§Ô∏è</button>
                        <button onclick="reactToMessage(${message.id}, 'üòä')" class="hover:scale-125 transition-transform">üòä</button>
                    </div>
                </div>
            `;
        }

        // Enhanced send message with better UX
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;

            // Disable send button temporarily
            const sendBtn = document.getElementById('sendButton');
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            // Add message with animation
            const newMessage = {
                id: messages.length + 1,
                text: text,
                time: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                sent: true,
                type: 'text'
            };

            messages.push(newMessage);
            input.value = '';
            updateCharCounter();
            autoResizeTextarea();
            renderMessages();

            // Re-enable send button
            setTimeout(() => {
                sendBtn.disabled = false;
                sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';
            }, 500);

            // Simulate smart responses
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    addSmartResponse(text);
                }, 2000 + Math.random() * 1000);
            }, 500);
        }

        // Smart response generation
        function addSmartResponse(userMessage) {
            const responses = {
                greeting: ["Ol√°! Como posso ajudar? üòä", "Oi! Tudo bem por a√≠?", "Hey! Que bom te ver!"],
                question: ["Interessante pergunta! ü§î", "Deixe-me pensar sobre isso...", "Boa pergunta!"],
                thanks: ["De nada! üòä", "Sempre √† disposi√ß√£o!", "Foi um prazer ajudar!"],
                project: ["Vamos discutir os detalhes!", "Adoro trabalhar em projetos assim!", "Quando come√ßamos?"],
                default: ["Entendi! üëç", "Interessante ponto de vista", "Concordo!", "Faz sentido!", "Excelente!"]
            };
            
            let responseType = 'default';
            const lowerMessage = userMessage.toLowerCase();
            
            if (lowerMessage.includes('ol√°') || lowerMessage.includes('oi')) responseType = 'greeting';
            else if (lowerMessage.includes('?')) responseType = 'question';
            else if (lowerMessage.includes('obrigad') || lowerMessage.includes('valeu')) responseType = 'thanks';
            else if (lowerMessage.includes('projeto') || lowerMessage.includes('trabalho')) responseType = 'project';
            
            const responseOptions = responses[responseType];
            const response = responseOptions[Math.floor(Math.random() * responseOptions.length)];
            
            const responseMessage = {
                id: messages.length + 1,
                text: response,
                time: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                sent: false,
                type: 'text'
            };
            
            messages.push(responseMessage);
            renderMessages();
        }

        // Enhanced typing indicator
        function showTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            const status = document.getElementById('chatStatus');
            
            indicator.classList.remove('hidden');
            status.innerHTML = '<span class="w-2 h-2 bg-blue-500 rounded-full mr-1 animate-pulse"></span>Digitando...';
            
            // Auto scroll
            setTimeout(() => {
                const container = document.getElementById('messagesContainer');
                container.scrollTo({
                    top: container.scrollHeight,
                    behavior: 'smooth'
                });
            }, 100);
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            const status = document.getElementById('chatStatus');
            const currentChatData = chatData.find(c => c.id === currentChat);
            
            indicator.classList.add('hidden');
            status.innerHTML = `<span class="w-2 h-2 bg-green-500 rounded-full mr-1 animate-pulse"></span>Online agora`;
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            const menuBtn = document.getElementById('mobileMenuBtn');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('hidden');
            
            // Animate menu button
            const icon = menuBtn.querySelector('i');
            if (sidebar.classList.contains('open')) {
                icon.className = 'fas fa-times text-gray-700';
            } else {
                icon.className = 'fas fa-bars text-gray-700';
            }
        }

        // Auto-resize textarea
        function autoResizeTextarea() {
            const textarea = document.getElementById('messageInput');
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        // Character counter
        function updateCharCounter() {
            const input = document.getElementById('messageInput');
            const counter = document.getElementById('charCounter');
            const sendBtn = document.getElementById('sendButton');
            
            counter.textContent = input.value.length;
            
            if (input.value.length > 1000) {
                counter.parentElement.classList.add('text-red-500');
                sendBtn.disabled = true;
            } else {
                counter.parentElement.classList.remove('text-red-500');
                sendBtn.disabled = false;
            }
        }

        // Theme toggle
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            const icon = document.getElementById('themeIcon');
            
            if (isDarkMode) {
                document.body.classList.add('dark');
                icon.className = 'fas fa-sun text-gray-500 group-hover:text-yellow-500 transition-colors';
            } else {
                document.body.classList.remove('dark');
                icon.className = 'fas fa-moon text-gray-500 group-hover:text-blue-500 transition-colors';
            }
        }

        // Voice recording
        function startVoiceRecord() {
            document.getElementById('voiceModal').classList.remove('hidden');
            // Simulate recording start
            setTimeout(() => {
                // Auto-stop after 5 seconds for demo
                stopVoiceRecord();
            }, 5000);
        }

        function stopVoiceRecord() {
            document.getElementById('voiceModal').classList.add('hidden');
            
            // Add voice message
            const voiceMessage = {
                id: messages.length + 1,
                text: "üé§ Mensagem de voz (0:05)",
                time: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                sent: true,
                type: 'voice'
            };
            
            messages.push(voiceMessage);
            renderMessages();
        }

        // Attachment menu
        function toggleAttachMenu() {
            const menu = document.getElementById('attachMenu');
            menu.classList.toggle('hidden');
        }

        // Emoji picker (simplified)
        function toggleEmojiPicker() {
            const emojis = ['üòä', 'üëç', '‚ù§Ô∏è', 'üòÇ', 'üéâ', 'üëè', 'üî•', 'üíØ'];
            const emoji = emojis[Math.floor(Math.random() * emojis.length)];
            const input = document.getElementById('messageInput');
            input.value += emoji;
            updateCharCounter();
        }

        // React to message
        function reactToMessage(messageId, reaction) {
            const message = messages.find(m => m.id === messageId);
            if (message) {
                if (!message.reactions) message.reactions = [];
                if (!message.reactions.includes(reaction)) {
                    message.reactions.push(reaction);
                    renderMessages();
                }
            }
        }

        // Call functions
        function startCall(type) {
            const currentChatData = chatData.find(c => c.id === currentChat);
            const callWindow = window.open('', '_blank', 'width=400,height=600');
            callWindow.document.write(`
                <div style="padding: 20px; text-align: center; font-family: system-ui;">
                    <h2>üìû ${type === 'audio' ? 'Chamada de √Åudio' : 'Chamada de V√≠deo'}</h2>
                    <p>Conectando com ${currentChatData?.name}...</p>
                    <button onclick="window.close()" style="background: #ef4444; color: white; padding: 10px 20px; border: none; border-radius: 20px; margin-top: 20px;">Encerrar</button>
                </div>
            `);
        }

        // Search functionality
        function initializeSearch() {
            const searchInput = document.getElementById('searchInput');
            
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                filterChats(query);
            });
            
            // Keyboard shortcut Cmd+K / Ctrl+K
            document.addEventListener('keydown', (e) => {
                if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                    e.preventDefault();
                    searchInput.focus();
                }
            });
        }

        function filterChats(query) {
            const chatItems = document.querySelectorAll('.chat-item');
            
            chatItems.forEach((item, index) => {
                const chat = chatData[index];
                const matchesName = chat.name.toLowerCase().includes(query);
                const matchesMessage = chat.lastMessage.toLowerCase().includes(query);
                
                if (matchesName || matchesMessage || query === '') {
                    item.style.display = 'block';
                    item.style.opacity = '1';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Voice command setup (basic)
        function setupVoiceCommand() {
            if ('webkitSpeechRecognition' in window) {
                // Voice commands could be implemented here
                console.log('Voice recognition available');
            }
        }

        // Event listeners setup
        function setupEventListeners() {
            const messageInput = document.getElementById('messageInput');
            
            // Enter to send, Shift+Enter for new line
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Auto-resize and character counter
            messageInput.addEventListener('input', function() {
                autoResizeTextarea();
                updateCharCounter();
                
                // Typing indicator simulation
                clearTimeout(typingTimer);
                if (!isTyping) {
                    isTyping = true;
                }
                
                typingTimer = setTimeout(() => {
                    isTyping = false;
                }, 1000);
            });
            
            // Click outside to close menus
            document.addEventListener('click', function(e) {
                const attachMenu = document.getElementById('attachMenu');
                if (!e.target.closest('#attachMenu') && !e.target.closest('[onclick="toggleAttachMenu()"]')) {
                    attachMenu.classList.add('hidden');
                }
            });
            
            // Responsive handling
            window.addEventListener('resize', handleResize);
        }

        function handleResize() {
            if (window.innerWidth >= 1024) {
                // Desktop view
                document.getElementById('sidebar').classList.remove('open');
                document.getElementById('mobileOverlay').classList.add('hidden');
                document.getElementById('mobileMenuBtn').querySelector('i').className = 'fas fa-bars text-gray-700';
            }
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>